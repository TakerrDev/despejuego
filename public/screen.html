<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>TRIVIAL DESPEDIDA</title>

<style>
body{
  margin:0;
  font-family:Arial, Helvetica, sans-serif;
  background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
  color:white;
  display:flex;
  flex-direction:column;
  height:100vh;
}

/* TOPBAR */
#topbar{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:20px 40px;
}

/* JUGADOR ACTIVO */
#activePlayer{
  font-size:60px;
  font-weight:bold;
  color:#ffd54f;
  text-shadow:0 0 15px rgba(255,213,79,.8);
  animation:pulse 1s infinite alternate;
}

@keyframes pulse{
  from{transform:scale(1)}
  to{transform:scale(1.06)}
}

/* SCORE */
#scores{
  display:flex;
  gap:40px;
  font-size:28px;
}

/* COMODINES */
#lifelinesBar{
  display:flex;
  gap:70px;
  font-size:28px;
}

.playerLife{
  display:flex;
  align-items:center;
  gap:12px;
}

.tag{
  font-weight:bold;
}

.life{
  background:#1e2a38;
  border-radius:50%;
  width:45px;
  height:45px;
  display:flex;
  align-items:center;
  justify-content:center;
  position:relative;
  transition:.25s;
}

/* contador */
.life::after{
  content:attr(data-count);
  position:absolute;
  bottom:-6px;
  right:-6px;
  background:#ffd54f;
  color:black;
  font-size:14px;
  border-radius:50%;
  width:20px;
  height:20px;
  display:flex;
  align-items:center;
  justify-content:center;
}

/* ocultar 0 */
.life[data-count="0"]::after{
  display:none;
}

/* gastado */
.life.used{
  opacity:.25;
  filter:grayscale(100%);
}

/* animaciones */
.life.pop{ animation:pop .25s ease; }
.life.flash{ animation:flash .4s alternate 3; }

@keyframes pop{
  50%{transform:scale(1.4)}
}

@keyframes flash{
  from{filter:brightness(1)}
  to{filter:brightness(2.5)}
}

/* PREGUNTA */
#question{
  text-align:center;
  font-size:48px;
  padding:40px;
  flex:1;
  display:flex;
  align-items:center;
  justify-content:center;
}

/* RESPUESTAS */
#answers{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:25px;
  padding:40px;
  flex:1.3;
}

.answer{
  background:#1e2a38;
  border-radius:20px;
  padding:25px;
  font-size:32px;
  display:flex;
  align-items:center;
  border:4px solid transparent;
  transition:.2s;
}

.letter{
  font-weight:bold;
  font-size:40px;
  margin-right:20px;
  color:#ffd54f;
}

.selected{border-color:yellow; transform:scale(1.05)}
.correct{background:#2ecc71!important}
.wrong{background:#e74c3c!important}

#status{
  text-align:center;
  font-size:30px;
  padding-bottom:20px;
  color:#ffd54f;
}

.question-enter {
  animation: questionIn .5s cubic-bezier(.2,.8,.2,1);
}

@keyframes questionIn {
  from {
    opacity:0;
    transform:translateY(40px) scale(.95);
  }
  to {
    opacity:1;
    transform:none;
  }
}

.selected {
  border-color:#ffd54f;
  transform:scale(1.08);
  box-shadow:
    0 0 10px #ffd54f,
    0 0 30px #ffd54f,
    0 0 60px rgba(255,213,79,.8);
}

.correct {
  background:#2ecc71!important;
  animation: correctBoom .6s ease;
}

@keyframes correctBoom {
  0%{ transform:scale(1); }
  40%{ transform:scale(1.2); }
  70%{ transform:scale(.95); }
  100%{ transform:scale(1); }
}

.wrong {
  background:#e74c3c!important;
  animation: wrongShake .5s, wrongFlash .5s;
}

@keyframes wrongShake {
  0%,100%{transform:translateX(0)}
  25%{transform:-12px}
  50%{transform:12px}
  75%{transform:-8px}
}

@keyframes wrongFlash {
  0%{filter:brightness(1)}
  50%{filter:brightness(2)}
  100%{filter:brightness(1)}
}
.answer.fadeOut {
  animation: fadeAnswer .4s forwards;
}

@keyframes fadeAnswer {
  to {
    opacity:0;
    transform:scale(.8);
  }
}

#winnerOverlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.9);
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:90px;
  color:#ffd54f;
  opacity:0;
  pointer-events:none;
  transition:.4s;
}

#winnerOverlay.show{
  opacity:1;
}




</style>
</head>

<body>

<div id="topbar">

  <div id="activePlayer">¬°PULSAD!</div>

  <div id="scores">
    <div>Petrus: <span id="s1">0</span></div>
    <div>Raquel: <span id="s2">0</span></div>
  </div>

  <div id="lifelinesBar">

    <div class="playerLife" id="lifeP1">
      <span class="tag">Petrus</span>
      <span class="life fifty" data-count="1">¬Ω</span>
      <span class="life public" data-count="1">üë•</span>
      <span class="life steal" data-count="1">‚ö°</span>
    </div>

    <div class="playerLife" id="lifeP2">
      <span class="tag">Raquel</span>
      <span class="life fifty" data-count="1">¬Ω</span>
      <span class="life public" data-count="1">üë•</span>
      <span class="life steal" data-count="1">‚ö°</span>
    </div>

  </div>

</div>

<div id="qrContainer" style="text-align:center; margin-top:20px;">
  <div style="display:flex; justify-content:center; gap:80px;">
    <div>
      <img id="qr1" width="180">
      <div>Pedro</div>
    </div>
    <div>
      <img id="qr2" width="180">
      <div>Raquel</div>
    </div>
  </div>
</div>


<div id="question">Pulsa N para empezar</div>

<div id="answers">
  <div class="answer" id="a0"><span class="letter">A</span><span></span></div>
  <div class="answer" id="a1"><span class="letter">B</span><span></span></div>
  <div class="answer" id="a2"><span class="letter">C</span><span></span></div>
  <div class="answer" id="a3"><span class="letter">D</span><span></span></div>
</div>

<div id="status"></div>
<div id="winnerOverlay"></div>
<script src="/socket.io/socket.io.js"></script>

<script>
/* ======================
   üîå SOCKET
====================== */
const socket = io();


/* ======================
   üîä SONIDOS
====================== */
const sndSelect  = new Audio("/sounds/select.mp3");
const sndCorrect = new Audio("/sounds/correct.mp3");
const sndWrong   = new Audio("/sounds/wrong.mp3");

[sndSelect, sndCorrect, sndWrong].forEach(s=>{
  s.preload = "auto";
  s.volume = 0.4;
});

/* desbloquear autoplay (click o tecla) */
function unlockAudio(){
  [sndSelect, sndCorrect, sndWrong].forEach(s=>{
    s.play().then(()=>s.pause()).catch(()=>{});
    s.currentTime = 0;
  });
}

document.addEventListener("click", unlockAudio, { once:true });
document.addEventListener("keydown", unlockAudio, { once:true });


/* ======================
   üì¶ DOM
====================== */
const s1 = document.getElementById("s1");
const s2 = document.getElementById("s2");
const questionEl = document.getElementById("question");
const statusEl = document.getElementById("status");
const activeEl = document.getElementById("activePlayer");

const answers = [
  document.getElementById("a0"),
  document.getElementById("a1"),
  document.getElementById("a2"),
  document.getElementById("a3")
];


/* ======================
   üì± QR AUTO LOAD
====================== */
fetch("/qr")
  .then(r => r.json())
  .then(data => {
    document.getElementById("qr1").src = data.qr1;
    document.getElementById("qr2").src = data.qr2;
  });


/* ======================
   üî≥ FULLSCREEN (F)
====================== */
document.addEventListener("keydown",(e)=>{
  if(e.key==="f"){
    if(!document.fullscreenElement)
      document.documentElement.requestFullscreen();
    else
      document.exitFullscreen();
  }
});


/* ======================
   üèÜ WINNER OVERLAY
====================== */
function showWinner(name){
  const w = document.getElementById("winnerOverlay");
  w.innerText = `üèÜ ${name} GANA üèÜ`;
  w.classList.add("show");
}


/* ======================
   üéØ LIFELINES UI
====================== */
function updateLifeIcons(playerId, lifelines){

  const root = playerId===1
    ? document.getElementById("lifeP1")
    : document.getElementById("lifeP2");

  const map = {
    fifty: root.querySelector(".fifty"),
    public: root.querySelector(".public"),
    steal: root.querySelector(".steal")
  };

  for(let key in map){

    const el = map[key];
    const old = parseInt(el.getAttribute("data-count")||0);
    const now = lifelines[key];

    el.setAttribute("data-count", now);

    el.classList.remove("pop","flash","used");

    if(now<=0){
      el.classList.add("used");
      continue;
    }

    if(now>old) el.classList.add("pop");
    if(now<old) el.classList.add("flash");

    setTimeout(()=>el.classList.remove("pop","flash"),300);
  }
}


/* ======================
   üéÆ SOCKET EVENTS
====================== */

socket.on("newQuestion",(q)=>{

  questionEl.innerText=q.text;

  answers.forEach((a,i)=>{
    a.querySelector("span:last-child").innerText=q.answers[i];
    a.className="answer";
    a.style.visibility="visible";
  });

  /* animaci√≥n entrada pregunta */
  questionEl.classList.remove("question-enter");
  void questionEl.offsetWidth;
  questionEl.classList.add("question-enter");

  activeEl.innerText="¬°PULSAD!";
  statusEl.innerText="";
});


socket.on("buzzed",(p)=>{
  activeEl.innerText=`TURNO DE ${p===1?"Petrus":"Raquel"}`;
});


socket.on("answerSelected",(i)=>{
  answers.forEach(a=>a.classList.remove("selected"));
  answers[i].classList.add("selected");

  sndSelect.currentTime = 0;
  sndSelect.play();
});


socket.on("answerResult",(d)=>{

  if(d.correct){
    sndCorrect.currentTime = 0;
    sndCorrect.play();

  } else {
    sndWrong.currentTime = 0;
    sndWrong.play();
  }

  answers[d.correctIndex].classList.add("correct");

  if(!d.correct)
    answers.forEach(a=>a.classList.contains("selected") && a.classList.add("wrong"));

  s1.innerText=d.scores[1];
  s2.innerText=d.scores[2];
});


socket.on("lifelineUpdate",({playerId,lifelines})=>{
  updateLifeIcons(playerId,lifelines);
});


/* 50/50 fade bonito */
socket.on("lifeline50",(removed)=>{
  removed.forEach(i=>{
    answers[i].classList.add("fadeOut");
  });
});


socket.on("lifelinePublic",(playerId)=>{
  statusEl.innerText=`üì¢ ${playerId===1?"Petrus":"Raquel"} consulta al p√∫blico`;
});


socket.on("turnStolen",(playerId)=>{
  activeEl.innerText=`‚ö° TURNO ROBADO ‚Üí ${playerId===1?"Petrus":"Raquel"}`;
});

socket.on("gameOver", ({winner, scores}) => {

  if (winner === 1) showWinner("Petrus");
  else if (winner === 2) showWinner("Raquel");
  else showWinner("EMPATE");

  statusEl.innerText = `Final: ${scores[1]} - ${scores[2]}`;
});

</script>


</body>
</html>
